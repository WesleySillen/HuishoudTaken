<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HuishoudTaken</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 1rem;
        max-width: 600px;
        margin: auto;
      }
      input,
      select,
      button {
        width: 100%;
        padding: 0.5rem;
        margin-top: 0.5rem;
        box-sizing: border-box;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        display: grid;
        grid-template-columns: auto 1fr auto; /* checkbox | tekst | delete */
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        border-bottom: 1px solid #ccc;
      }

      li input[type="checkbox"] {
        justify-self: start;
      }

      li button {
        justify-self: end;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1rem;
      }

      li span {
        text-align: center;
        word-wrap: break-word;
        white-space: normal;
      }

      .done {
        text-decoration: line-through;
        color: gray;
      }
      nav {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }
      nav button {
        flex: 1;
        padding: 0.5rem;
        border: none;
        background: #eee;
        cursor: pointer;
      }
      nav button.active {
        background: #007bff;
        color: white;
      }
      .daily {
        background-color: #e0f7fa; /* lichtblauw */
      }
      .weekly {
        background-color: #f1f8e9; /* lichtgroen */
      }
      .monthly {
        background-color: #fff3e0; /* lichtoranje */
      }
      .halfyearly {
        background-color: #f3e5f5; /* lichtpaars */
      }
      .yearly {
        background-color: #e0e0e0; /* lichtgrijs */
      }
      nav button.daily {
        background-color: #e0f7fa;
      }
      nav button.weekly {
        background-color: #f1f8e9;
      }
      nav button.monthly {
        background-color: #fff3e0;
      }
      nav button.halfyearly {
        background-color: #f3e5f5;
      }
      nav button.yearly {
        background-color: #e0e0e0;
      }
      h1 {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>Taken à la Casa</h1>

    <nav id="nav">
      <button onclick="setFilter('all')" class="active">Alle</button>
      <button onclick="setFilter('daily')" class="daily">Dagelijks</button>
      <button onclick="setFilter('weekly')" class="weekly">Wekelijks</button>
      <button onclick="setFilter('monthly')" class="monthly">
        Maandelijks
      </button>
      <button onclick="setFilter('halfyearly')" class="halfyearly">
        Halfjaarlijks
      </button>
      <button onclick="setFilter('yearly')" class="yearly">Jaarlijks</button>
    </nav>

    <input id="task" placeholder="Nieuwe taak..." />
    <select id="repeat">
      <option value="none">Eenmalig</option>
      <option value="daily">Dagelijks</option>
      <option value="weekly">Wekelijks</option>
      <option value="monthly">Maandelijks</option>
      <option value="halfyearly">Halfjaarlijks</option>
      <option value="yearly">Jaarlijks</option>
    </select>
    <button onclick="addTask()">Toevoegen</button>
    <ul id="list"></ul>

    <script>
      let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
      let currentFilter = "all";

      function setFilter(filter) {
        currentFilter = filter;
        document
          .querySelectorAll("nav button")
          .forEach((btn) => btn.classList.remove("active"));
        document
          .querySelector(`nav button[onclick="setFilter('${filter}')"]`)
          .classList.add("active");
        renderTasks();
      }

      function shouldReset(task) {
        const now = new Date();
        const last = new Date(task.lastReset || task.createdAt);
        const diffDays = Math.floor((now - last) / (1000 * 60 * 60 * 24));
        switch (task.repeat) {
          case "daily":
            return diffDays >= 1;
          case "weekly":
            return diffDays >= 7;
          case "monthly":
            return (
              now.getMonth() !== last.getMonth() ||
              now.getFullYear() !== last.getFullYear()
            );
          case "halfyearly":
            return (
              now.getFullYear() !== last.getFullYear() ||
              Math.abs(now.getMonth() - last.getMonth()) >= 6
            );
          case "yearly":
            return now.getFullYear() !== last.getFullYear();
          default:
            return false;
        }
      }

      function renderTasks() {
        const list = document.getElementById("list");
        list.innerHTML = "";

        tasks.forEach((task, i) => {
          // Filter toepassen
          if (currentFilter !== "all" && task.repeat !== currentFilter) {
            return; // sla deze taak over
          }

          // Reset herhalende taken indien nodig
          if (shouldReset(task)) {
            task.done = false;
            task.lastReset = new Date().toISOString();
            task.completedAt = null;
          }

          const li = document.createElement("li");
          if (task.done) li.classList.add("done");
          li.classList.add(task.repeat); // voeg type-kleur toe

          // Taaktekst
          const span = document.createElement("span");
          span.textContent = `${task.text}`;

          // Checkbox
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = task.done;
          checkbox.addEventListener("change", () => toggleTask(i));

          // Verwijderknop
          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "🗑️";
          deleteBtn.style.marginLeft = "8px";
          deleteBtn.addEventListener("click", () => deleteTask(i));

          // Samenstellen
          li.appendChild(checkbox);
          li.appendChild(span);
          li.appendChild(deleteBtn);
          list.appendChild(li);
        });

        cleanUpOneTimeTasks(); // Opruimen van voltooide eenmalige taken
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }

      function addTask() {
        const input = document.getElementById("task");
        const repeat = document.getElementById("repeat").value;
        const task = {
          text: input.value,
          done: false,
          repeat: repeat,
          createdAt: new Date().toISOString(),
          lastReset: new Date().toISOString(),
        };
        tasks.push(task);
        input.value = "";
        renderTasks();
      }

      function cleanUpOneTimeTasks() {
        const now = new Date();
        tasks = tasks.filter((task) => {
          if (task.repeat !== "none") return true;
          if (!task.done) return true;
          if (!task.completedAt) return true;

          const completed = new Date(task.completedAt);
          return now.toDateString() === completed.toDateString();
        });
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }

      function deleteTask(i) {
        tasks.splice(i, 1);
        localStorage.setItem("tasks", JSON.stringify(tasks));
        renderTasks();
      }

      function toggleTask(i) {
        tasks[i].done = !tasks[i].done;
        tasks[i].completedAt = tasks[i].done ? new Date().toISOString() : null;
        localStorage.setItem("tasks", JSON.stringify(tasks));

        // Kleine vertraging zodat de checkbox zichzelf eerst kan aanpassen
        setTimeout(renderTasks, 10);
      }

      renderTasks();
    </script>
  </body>
</html>
